{"version":3,"file":"three-to-cannon.cjs","sources":["../lib/ConvexHull.js","../src/utils.ts","../src/index.ts"],"sourcesContent":["import {\n\tLine3,\n\tPlane,\n\tTriangle,\n\tVector3\n} from 'three';\n/**\n * Ported from: https://github.com/maurizzzio/quickhull3d/ by Mauricio Poppe (https://github.com/maurizzzio)\n */\n\nvar ConvexHull = ( function () {\n\n\tvar Visible = 0;\n\tvar Deleted = 1;\n\n\tvar v1 = new Vector3();\n\n\tfunction ConvexHull() {\n\n\t\tthis.tolerance = - 1;\n\n\t\tthis.faces = []; // the generated faces of the convex hull\n\t\tthis.newFaces = []; // this array holds the faces that are generated within a single iteration\n\n\t\t// the vertex lists work as follows:\n\t\t//\n\t\t// let 'a' and 'b' be 'Face' instances\n\t\t// let 'v' be points wrapped as instance of 'Vertex'\n\t\t//\n\t\t//     [v, v, ..., v, v, v, ...]\n\t\t//      ^             ^\n\t\t//      |             |\n\t\t//  a.outside     b.outside\n\t\t//\n\t\tthis.assigned = new VertexList();\n\t\tthis.unassigned = new VertexList();\n\n\t\tthis.vertices = []; \t// vertices of the hull (internal representation of given geometry data)\n\n\t}\n\n\tObject.assign( ConvexHull.prototype, {\n\n\t\ttoJSON: function () {\n\t\t\t// Original ('src') indices do not include interior vertices,\n\t\t\t// but 'this.vertices' (the list they index) does. Output ('dst')\n\t\t\t// arrays have interior vertices omitted.\n\n\t\t\tconst srcIndices = this.faces.map((f) => f.toArray());\n\t\t\tconst uniqueSrcIndices = Array.from(new Set(srcIndices.flat())).sort();\n\n\t\t\t// Output vertex positions, omitting interior vertices.\n\t\t\tconst dstPositions = [];\n\t\t\tfor (let i = 0; i < uniqueSrcIndices.length; i++) {\n\t\t\t\tdstPositions.push(\n\t\t\t\t\tthis.vertices[uniqueSrcIndices[i]].point.x,\n\t\t\t\t\tthis.vertices[uniqueSrcIndices[i]].point.y,\n\t\t\t\t\tthis.vertices[uniqueSrcIndices[i]].point.z,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Mapping from 'src' (this.vertices) to 'dst' (dstPositions) indices.\n\t\t\tconst srcToDstIndexMap = new Map();\n\t\t\tfor (let i = 0; i < uniqueSrcIndices.length; i++) {\n\t\t\t\tsrcToDstIndexMap.set(uniqueSrcIndices[i], i);\n\t\t\t}\n\n\t\t\t// Output triangles, as indices on dstPositions.\n\t\t\tconst dstIndices = [];\n\t\t\tfor (let i = 0; i < srcIndices.length; i++) {\n\t\t\t\tdstIndices.push([\n\t\t\t\t\tsrcToDstIndexMap.get(srcIndices[i][0]),\n\t\t\t\t\tsrcToDstIndexMap.get(srcIndices[i][1]),\n\t\t\t\t\tsrcToDstIndexMap.get(srcIndices[i][2]),\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\treturn [dstPositions, dstIndices];\n\t\t},\n\n\t\tsetFromPoints: function ( points ) {\n\n\t\t\tif ( Array.isArray( points ) !== true ) {\n\n\t\t\t\tconsole.error( 'THREE.ConvexHull: Points parameter is not an array.' );\n\n\t\t\t}\n\n\t\t\tif ( points.length < 4 ) {\n\n\t\t\t\tconsole.error( 'THREE.ConvexHull: The algorithm needs at least four points.' );\n\n\t\t\t}\n\n\t\t\tthis.makeEmpty();\n\n\t\t\tfor ( var i = 0, l = points.length; i < l; i ++ ) {\n\n\t\t\t\tthis.vertices.push( new VertexNode( points[ i ], i ) );\n\n\t\t\t}\n\n\t\t\tthis.compute();\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetFromObject: function ( object ) {\n\n\t\t\tvar points = [];\n\n\t\t\tobject.updateMatrixWorld( true );\n\n\t\t\tobject.traverse( function ( node ) {\n\n\t\t\t\tvar i, l, point;\n\n\t\t\t\tvar geometry = node.geometry;\n\n\t\t\t\tif ( geometry === undefined ) return;\n\n\t\t\t\tif ( geometry.isGeometry ) {\n\n\t\t\t\t\tgeometry = geometry.toBufferGeometry\n\t\t\t\t\t\t? geometry.toBufferGeometry()\n\t\t\t\t\t\t: new BufferGeometry().fromGeometry( geometry );\n\n\t\t\t\t}\n\n\t\t\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\t\t\tvar attribute = geometry.attributes.position;\n\n\t\t\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\t\t\tfor ( i = 0, l = attribute.count; i < l; i ++ ) {\n\n\t\t\t\t\t\t\tpoint = new Vector3();\n\n\t\t\t\t\t\t\tpoint.fromBufferAttribute( attribute, i ).applyMatrix4( node.matrixWorld );\n\n\t\t\t\t\t\t\tpoints.push( point );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\treturn this.setFromPoints( points );\n\n\t\t},\n\n\t\tcontainsPoint: function ( point ) {\n\n\t\t\tvar faces = this.faces;\n\n\t\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\n\n\t\t\t\tvar face = faces[ i ];\n\n\t\t\t\t// compute signed distance and check on what half space the point lies\n\n\t\t\t\tif ( face.distanceToPoint( point ) > this.tolerance ) return false;\n\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t},\n\n\t\tintersectRay: function ( ray, target ) {\n\n\t\t\t// based on \"Fast Ray-Convex Polyhedron Intersection\"  by Eric Haines, GRAPHICS GEMS II\n\n\t\t\tvar faces = this.faces;\n\n\t\t\tvar tNear = - Infinity;\n\t\t\tvar tFar = Infinity;\n\n\t\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\n\n\t\t\t\tvar face = faces[ i ];\n\n\t\t\t\t// interpret faces as planes for the further computation\n\n\t\t\t\tvar vN = face.distanceToPoint( ray.origin );\n\t\t\t\tvar vD = face.normal.dot( ray.direction );\n\n\t\t\t\t// if the origin is on the positive side of a plane (so the plane can \"see\" the origin) and\n\t\t\t\t// the ray is turned away or parallel to the plane, there is no intersection\n\n\t\t\t\tif ( vN > 0 && vD >= 0 ) return null;\n\n\t\t\t\t// compute the distance from the ray’s origin to the intersection with the plane\n\n\t\t\t\tvar t = ( vD !== 0 ) ? ( - vN / vD ) : 0;\n\n\t\t\t\t// only proceed if the distance is positive. a negative distance means the intersection point\n\t\t\t\t// lies \"behind\" the origin\n\n\t\t\t\tif ( t <= 0 ) continue;\n\n\t\t\t\t// now categorized plane as front-facing or back-facing\n\n\t\t\t\tif ( vD > 0 ) {\n\n\t\t\t\t\t//  plane faces away from the ray, so this plane is a back-face\n\n\t\t\t\t\ttFar = Math.min( t, tFar );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// front-face\n\n\t\t\t\t\ttNear = Math.max( t, tNear );\n\n\t\t\t\t}\n\n\t\t\t\tif ( tNear > tFar ) {\n\n\t\t\t\t\t// if tNear ever is greater than tFar, the ray must miss the convex hull\n\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// evaluate intersection point\n\n\t\t\t// always try tNear first since its the closer intersection point\n\n\t\t\tif ( tNear !== - Infinity ) {\n\n\t\t\t\tray.at( tNear, target );\n\n\t\t\t} else {\n\n\t\t\t\tray.at( tFar, target );\n\n\t\t\t}\n\n\t\t\treturn target;\n\n\t\t},\n\n\t\tintersectsRay: function ( ray ) {\n\n\t\t\treturn this.intersectRay( ray, v1 ) !== null;\n\n\t\t},\n\n\t\tmakeEmpty: function () {\n\n\t\t\tthis.faces = [];\n\t\t\tthis.vertices = [];\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Adds a vertex to the 'assigned' list of vertices and assigns it to the given face\n\n\t\taddVertexToFace: function ( vertex, face ) {\n\n\t\t\tvertex.face = face;\n\n\t\t\tif ( face.outside === null ) {\n\n\t\t\t\tthis.assigned.append( vertex );\n\n\t\t\t} else {\n\n\t\t\t\tthis.assigned.insertBefore( face.outside, vertex );\n\n\t\t\t}\n\n\t\t\tface.outside = vertex;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Removes a vertex from the 'assigned' list of vertices and from the given face\n\n\t\tremoveVertexFromFace: function ( vertex, face ) {\n\n\t\t\tif ( vertex === face.outside ) {\n\n\t\t\t\t// fix face.outside link\n\n\t\t\t\tif ( vertex.next !== null && vertex.next.face === face ) {\n\n\t\t\t\t\t// face has at least 2 outside vertices, move the 'outside' reference\n\n\t\t\t\t\tface.outside = vertex.next;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// vertex was the only outside vertex that face had\n\n\t\t\t\t\tface.outside = null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.assigned.remove( vertex );\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Removes all the visible vertices that a given face is able to see which are stored in the 'assigned' vertext list\n\n\t\tremoveAllVerticesFromFace: function ( face ) {\n\n\t\t\tif ( face.outside !== null ) {\n\n\t\t\t\t// reference to the first and last vertex of this face\n\n\t\t\t\tvar start = face.outside;\n\t\t\t\tvar end = face.outside;\n\n\t\t\t\twhile ( end.next !== null && end.next.face === face ) {\n\n\t\t\t\t\tend = end.next;\n\n\t\t\t\t}\n\n\t\t\t\tthis.assigned.removeSubList( start, end );\n\n\t\t\t\t// fix references\n\n\t\t\t\tstart.prev = end.next = null;\n\t\t\t\tface.outside = null;\n\n\t\t\t\treturn start;\n\n\t\t\t}\n\n\t\t},\n\n\t\t// Removes all the visible vertices that 'face' is able to see\n\n\t\tdeleteFaceVertices: function ( face, absorbingFace ) {\n\n\t\t\tvar faceVertices = this.removeAllVerticesFromFace( face );\n\n\t\t\tif ( faceVertices !== undefined ) {\n\n\t\t\t\tif ( absorbingFace === undefined ) {\n\n\t\t\t\t\t// mark the vertices to be reassigned to some other face\n\n\t\t\t\t\tthis.unassigned.appendChain( faceVertices );\n\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// if there's an absorbing face try to assign as many vertices as possible to it\n\n\t\t\t\t\tvar vertex = faceVertices;\n\n\t\t\t\t\tdo {\n\n\t\t\t\t\t\t// we need to buffer the subsequent vertex at this point because the 'vertex.next' reference\n\t\t\t\t\t\t// will be changed by upcoming method calls\n\n\t\t\t\t\t\tvar nextVertex = vertex.next;\n\n\t\t\t\t\t\tvar distance = absorbingFace.distanceToPoint( vertex.point );\n\n\t\t\t\t\t\t// check if 'vertex' is able to see 'absorbingFace'\n\n\t\t\t\t\t\tif ( distance > this.tolerance ) {\n\n\t\t\t\t\t\t\tthis.addVertexToFace( vertex, absorbingFace );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tthis.unassigned.append( vertex );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// now assign next vertex\n\n\t\t\t\t\t\tvertex = nextVertex;\n\n\t\t\t\t\t} while ( vertex !== null );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Reassigns as many vertices as possible from the unassigned list to the new faces\n\n\t\tresolveUnassignedPoints: function ( newFaces ) {\n\n\t\t\tif ( this.unassigned.isEmpty() === false ) {\n\n\t\t\t\tvar vertex = this.unassigned.first();\n\n\t\t\t\tdo {\n\n\t\t\t\t\t// buffer 'next' reference, see .deleteFaceVertices()\n\n\t\t\t\t\tvar nextVertex = vertex.next;\n\n\t\t\t\t\tvar maxDistance = this.tolerance;\n\n\t\t\t\t\tvar maxFace = null;\n\n\t\t\t\t\tfor ( var i = 0; i < newFaces.length; i ++ ) {\n\n\t\t\t\t\t\tvar face = newFaces[ i ];\n\n\t\t\t\t\t\tif ( face.mark === Visible ) {\n\n\t\t\t\t\t\t\tvar distance = face.distanceToPoint( vertex.point );\n\n\t\t\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\t\t\tmaxFace = face;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( maxDistance > 1000 * this.tolerance ) break;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// 'maxFace' can be null e.g. if there are identical vertices\n\n\t\t\t\t\tif ( maxFace !== null ) {\n\n\t\t\t\t\t\tthis.addVertexToFace( vertex, maxFace );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvertex = nextVertex;\n\n\t\t\t\t} while ( vertex !== null );\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Computes the extremes of a simplex which will be the initial hull\n\n\t\tcomputeExtremes: function () {\n\n\t\t\tvar min = new Vector3();\n\t\t\tvar max = new Vector3();\n\n\t\t\tvar minVertices = [];\n\t\t\tvar maxVertices = [];\n\n\t\t\tvar i, l, j;\n\n\t\t\t// initially assume that the first vertex is the min/max\n\n\t\t\tfor ( i = 0; i < 3; i ++ ) {\n\n\t\t\t\tminVertices[ i ] = maxVertices[ i ] = this.vertices[ 0 ];\n\n\t\t\t}\n\n\t\t\tmin.copy( this.vertices[ 0 ].point );\n\t\t\tmax.copy( this.vertices[ 0 ].point );\n\n\t\t\t// compute the min/max vertex on all six directions\n\n\t\t\tfor ( i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\t\tvar vertex = this.vertices[ i ];\n\t\t\t\tvar point = vertex.point;\n\n\t\t\t\t// update the min coordinates\n\n\t\t\t\tfor ( j = 0; j < 3; j ++ ) {\n\n\t\t\t\t\tif ( point.getComponent( j ) < min.getComponent( j ) ) {\n\n\t\t\t\t\t\tmin.setComponent( j, point.getComponent( j ) );\n\t\t\t\t\t\tminVertices[ j ] = vertex;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// update the max coordinates\n\n\t\t\t\tfor ( j = 0; j < 3; j ++ ) {\n\n\t\t\t\t\tif ( point.getComponent( j ) > max.getComponent( j ) ) {\n\n\t\t\t\t\t\tmax.setComponent( j, point.getComponent( j ) );\n\t\t\t\t\t\tmaxVertices[ j ] = vertex;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// use min/max vectors to compute an optimal epsilon\n\n\t\t\tthis.tolerance = 3 * Number.EPSILON * (\n\t\t\t\tMath.max( Math.abs( min.x ), Math.abs( max.x ) ) +\n\t\t\t\tMath.max( Math.abs( min.y ), Math.abs( max.y ) ) +\n\t\t\t\tMath.max( Math.abs( min.z ), Math.abs( max.z ) )\n\t\t\t);\n\n\t\t\treturn { min: minVertices, max: maxVertices };\n\n\t\t},\n\n\t\t// Computes the initial simplex assigning to its faces all the points\n\t\t// that are candidates to form part of the hull\n\n\t\tcomputeInitialHull: function () {\n\n\t\t\tvar line3, plane, closestPoint;\n\n\t\t\treturn function computeInitialHull() {\n\n\t\t\t\tif ( line3 === undefined ) {\n\n\t\t\t\t\tline3 = new Line3();\n\t\t\t\t\tplane = new Plane();\n\t\t\t\t\tclosestPoint = new Vector3();\n\n\t\t\t\t}\n\n\t\t\t\tvar vertex, vertices = this.vertices;\n\t\t\t\tvar extremes = this.computeExtremes();\n\t\t\t\tvar min = extremes.min;\n\t\t\t\tvar max = extremes.max;\n\n\t\t\t\tvar v0, v1, v2, v3;\n\t\t\t\tvar i, l, j;\n\n\t\t\t\t// 1. Find the two vertices 'v0' and 'v1' with the greatest 1d separation\n\t\t\t\t// (max.x - min.x)\n\t\t\t\t// (max.y - min.y)\n\t\t\t\t// (max.z - min.z)\n\n\t\t\t\tvar distance, maxDistance = 0;\n\t\t\t\tvar index = 0;\n\n\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\n\n\t\t\t\t\tdistance = max[ i ].point.getComponent( i ) - min[ i ].point.getComponent( i );\n\n\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\tindex = i;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tv0 = min[ index ];\n\t\t\t\tv1 = max[ index ];\n\n\t\t\t\t// 2. The next vertex 'v2' is the one farthest to the line formed by 'v0' and 'v1'\n\n\t\t\t\tmaxDistance = 0;\n\t\t\t\tline3.set( v0.point, v1.point );\n\n\t\t\t\tfor ( i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\t\t\tvertex = vertices[ i ];\n\n\t\t\t\t\tif ( vertex !== v0 && vertex !== v1 ) {\n\n\t\t\t\t\t\tline3.closestPointToPoint( vertex.point, true, closestPoint );\n\n\t\t\t\t\t\tdistance = closestPoint.distanceToSquared( vertex.point );\n\n\t\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\t\tv2 = vertex;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// 3. The next vertex 'v3' is the one farthest to the plane 'v0', 'v1', 'v2'\n\n\t\t\t\tmaxDistance = - 1;\n\t\t\t\tplane.setFromCoplanarPoints( v0.point, v1.point, v2.point );\n\n\t\t\t\tfor ( i = 0, l = this.vertices.length; i < l; i ++ ) {\n\n\t\t\t\t\tvertex = vertices[ i ];\n\n\t\t\t\t\tif ( vertex !== v0 && vertex !== v1 && vertex !== v2 ) {\n\n\t\t\t\t\t\tdistance = Math.abs( plane.distanceToPoint( vertex.point ) );\n\n\t\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\t\tv3 = vertex;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar faces = [];\n\n\t\t\t\tif ( plane.distanceToPoint( v3.point ) < 0 ) {\n\n\t\t\t\t\t// the face is not able to see the point so 'plane.normal' is pointing outside the tetrahedron\n\n\t\t\t\t\tfaces.push(\n\t\t\t\t\t\tFace.create( v0, v1, v2 ),\n\t\t\t\t\t\tFace.create( v3, v1, v0 ),\n\t\t\t\t\t\tFace.create( v3, v2, v1 ),\n\t\t\t\t\t\tFace.create( v3, v0, v2 )\n\t\t\t\t\t);\n\n\t\t\t\t\t// set the twin edge\n\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\n\n\t\t\t\t\t\tj = ( i + 1 ) % 3;\n\n\t\t\t\t\t\t// join face[ i ] i > 0, with the first face\n\n\t\t\t\t\t\tfaces[ i + 1 ].getEdge( 2 ).setTwin( faces[ 0 ].getEdge( j ) );\n\n\t\t\t\t\t\t// join face[ i ] with face[ i + 1 ], 1 <= i <= 3\n\n\t\t\t\t\t\tfaces[ i + 1 ].getEdge( 1 ).setTwin( faces[ j + 1 ].getEdge( 0 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// the face is able to see the point so 'plane.normal' is pointing inside the tetrahedron\n\n\t\t\t\t\tfaces.push(\n\t\t\t\t\t\tFace.create( v0, v2, v1 ),\n\t\t\t\t\t\tFace.create( v3, v0, v1 ),\n\t\t\t\t\t\tFace.create( v3, v1, v2 ),\n\t\t\t\t\t\tFace.create( v3, v2, v0 )\n\t\t\t\t\t);\n\n\t\t\t\t\t// set the twin edge\n\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\n\n\t\t\t\t\t\tj = ( i + 1 ) % 3;\n\n\t\t\t\t\t\t// join face[ i ] i > 0, with the first face\n\n\t\t\t\t\t\tfaces[ i + 1 ].getEdge( 2 ).setTwin( faces[ 0 ].getEdge( ( 3 - i ) % 3 ) );\n\n\t\t\t\t\t\t// join face[ i ] with face[ i + 1 ]\n\n\t\t\t\t\t\tfaces[ i + 1 ].getEdge( 0 ).setTwin( faces[ j + 1 ].getEdge( 1 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// the initial hull is the tetrahedron\n\n\t\t\t\tfor ( i = 0; i < 4; i ++ ) {\n\n\t\t\t\t\tthis.faces.push( faces[ i ] );\n\n\t\t\t\t}\n\n\t\t\t\t// initial assignment of vertices to the faces of the tetrahedron\n\n\t\t\t\tfor ( i = 0, l = vertices.length; i < l; i ++ ) {\n\n\t\t\t\t\tvertex = vertices[ i ];\n\n\t\t\t\t\tif ( vertex !== v0 && vertex !== v1 && vertex !== v2 && vertex !== v3 ) {\n\n\t\t\t\t\t\tmaxDistance = this.tolerance;\n\t\t\t\t\t\tvar maxFace = null;\n\n\t\t\t\t\t\tfor ( j = 0; j < 4; j ++ ) {\n\n\t\t\t\t\t\t\tdistance = this.faces[ j ].distanceToPoint( vertex.point );\n\n\t\t\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\t\t\tmaxFace = this.faces[ j ];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( maxFace !== null ) {\n\n\t\t\t\t\t\t\tthis.addVertexToFace( vertex, maxFace );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\n\t\t\t};\n\n\t\t}(),\n\n\t\t// Removes inactive faces\n\n\t\treindexFaces: function () {\n\n\t\t\tvar activeFaces = [];\n\n\t\t\tfor ( var i = 0; i < this.faces.length; i ++ ) {\n\n\t\t\t\tvar face = this.faces[ i ];\n\n\t\t\t\tif ( face.mark === Visible ) {\n\n\t\t\t\t\tactiveFaces.push( face );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.faces = activeFaces;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Finds the next vertex to create faces with the current hull\n\n\t\tnextVertexToAdd: function () {\n\n\t\t\t// if the 'assigned' list of vertices is empty, no vertices are left. return with 'undefined'\n\n\t\t\tif ( this.assigned.isEmpty() === false ) {\n\n\t\t\t\tvar eyeVertex, maxDistance = 0;\n\n\t\t\t\t// grap the first available face and start with the first visible vertex of that face\n\n\t\t\t\tvar eyeFace = this.assigned.first().face;\n\t\t\t\tvar vertex = eyeFace.outside;\n\n\t\t\t\t// now calculate the farthest vertex that face can see\n\n\t\t\t\tdo {\n\n\t\t\t\t\tvar distance = eyeFace.distanceToPoint( vertex.point );\n\n\t\t\t\t\tif ( distance > maxDistance ) {\n\n\t\t\t\t\t\tmaxDistance = distance;\n\t\t\t\t\t\teyeVertex = vertex;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvertex = vertex.next;\n\n\t\t\t\t} while ( vertex !== null && vertex.face === eyeFace );\n\n\t\t\t\treturn eyeVertex;\n\n\t\t\t}\n\n\t\t},\n\n\t\t// Computes a chain of half edges in CCW order called the 'horizon'.\n\t\t// For an edge to be part of the horizon it must join a face that can see\n\t\t// 'eyePoint' and a face that cannot see 'eyePoint'.\n\n\t\tcomputeHorizon: function ( eyePoint, crossEdge, face, horizon ) {\n\n\t\t\t// moves face's vertices to the 'unassigned' vertex list\n\n\t\t\tthis.deleteFaceVertices( face );\n\n\t\t\tface.mark = Deleted;\n\n\t\t\tvar edge;\n\n\t\t\tif ( crossEdge === null ) {\n\n\t\t\t\tedge = crossEdge = face.getEdge( 0 );\n\n\t\t\t} else {\n\n\t\t\t\t// start from the next edge since 'crossEdge' was already analyzed\n\t\t\t\t// (actually 'crossEdge.twin' was the edge who called this method recursively)\n\n\t\t\t\tedge = crossEdge.next;\n\n\t\t\t}\n\n\t\t\tdo {\n\n\t\t\t\tvar twinEdge = edge.twin;\n\t\t\t\tvar oppositeFace = twinEdge.face;\n\n\t\t\t\tif ( oppositeFace.mark === Visible ) {\n\n\t\t\t\t\tif ( oppositeFace.distanceToPoint( eyePoint ) > this.tolerance ) {\n\n\t\t\t\t\t\t// the opposite face can see the vertex, so proceed with next edge\n\n\t\t\t\t\t\tthis.computeHorizon( eyePoint, twinEdge, oppositeFace, horizon );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// the opposite face can't see the vertex, so this edge is part of the horizon\n\n\t\t\t\t\t\thorizon.push( edge );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tedge = edge.next;\n\n\t\t\t} while ( edge !== crossEdge );\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Creates a face with the vertices 'eyeVertex.point', 'horizonEdge.tail' and 'horizonEdge.head' in CCW order\n\n\t\taddAdjoiningFace: function ( eyeVertex, horizonEdge ) {\n\n\t\t\t// all the half edges are created in ccw order thus the face is always pointing outside the hull\n\n\t\t\tvar face = Face.create( eyeVertex, horizonEdge.tail(), horizonEdge.head() );\n\n\t\t\tthis.faces.push( face );\n\n\t\t\t// join face.getEdge( - 1 ) with the horizon's opposite edge face.getEdge( - 1 ) = face.getEdge( 2 )\n\n\t\t\tface.getEdge( - 1 ).setTwin( horizonEdge.twin );\n\n\t\t\treturn face.getEdge( 0 ); // the half edge whose vertex is the eyeVertex\n\n\n\t\t},\n\n\t\t//  Adds 'horizon.length' faces to the hull, each face will be linked with the\n\t\t//  horizon opposite face and the face on the left/right\n\n\t\taddNewFaces: function ( eyeVertex, horizon ) {\n\n\t\t\tthis.newFaces = [];\n\n\t\t\tvar firstSideEdge = null;\n\t\t\tvar previousSideEdge = null;\n\n\t\t\tfor ( var i = 0; i < horizon.length; i ++ ) {\n\n\t\t\t\tvar horizonEdge = horizon[ i ];\n\n\t\t\t\t// returns the right side edge\n\n\t\t\t\tvar sideEdge = this.addAdjoiningFace( eyeVertex, horizonEdge );\n\n\t\t\t\tif ( firstSideEdge === null ) {\n\n\t\t\t\t\tfirstSideEdge = sideEdge;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// joins face.getEdge( 1 ) with previousFace.getEdge( 0 )\n\n\t\t\t\t\tsideEdge.next.setTwin( previousSideEdge );\n\n\t\t\t\t}\n\n\t\t\t\tthis.newFaces.push( sideEdge.face );\n\t\t\t\tpreviousSideEdge = sideEdge;\n\n\t\t\t}\n\n\t\t\t// perform final join of new faces\n\n\t\t\tfirstSideEdge.next.setTwin( previousSideEdge );\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Adds a vertex to the hull\n\n\t\taddVertexToHull: function ( eyeVertex ) {\n\n\t\t\tvar horizon = [];\n\n\t\t\tthis.unassigned.clear();\n\n\t\t\t// remove 'eyeVertex' from 'eyeVertex.face' so that it can't be added to the 'unassigned' vertex list\n\n\t\t\tthis.removeVertexFromFace( eyeVertex, eyeVertex.face );\n\n\t\t\tthis.computeHorizon( eyeVertex.point, null, eyeVertex.face, horizon );\n\n\t\t\tthis.addNewFaces( eyeVertex, horizon );\n\n\t\t\t// reassign 'unassigned' vertices to the new faces\n\n\t\t\tthis.resolveUnassignedPoints( this.newFaces );\n\n\t\t\treturn\tthis;\n\n\t\t},\n\n\t\tcleanup: function () {\n\n\t\t\tthis.assigned.clear();\n\t\t\tthis.unassigned.clear();\n\t\t\tthis.newFaces = [];\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tcompute: function () {\n\n\t\t\tvar vertex;\n\n\t\t\tthis.computeInitialHull();\n\n\t\t\t// add all available vertices gradually to the hull\n\n\t\t\twhile ( ( vertex = this.nextVertexToAdd() ) !== undefined ) {\n\n\t\t\t\tthis.addVertexToHull( vertex );\n\n\t\t\t}\n\n\t\t\tthis.reindexFaces();\n\n\t\t\tthis.cleanup();\n\n\t\t\treturn this;\n\n\t\t}\n\n\t} );\n\n\t//\n\n\tfunction Face() {\n\n\t\tthis.normal = new Vector3();\n\t\tthis.midpoint = new Vector3();\n\t\tthis.area = 0;\n\n\t\tthis.constant = 0; // signed distance from face to the origin\n\t\tthis.outside = null; // reference to a vertex in a vertex list this face can see\n\t\tthis.mark = Visible;\n\t\tthis.edge = null;\n\n\t}\n\n\tObject.assign( Face, {\n\n\t\tcreate: function ( a, b, c ) {\n\n\t\t\tvar face = new Face();\n\n\t\t\tvar e0 = new HalfEdge( a, face );\n\t\t\tvar e1 = new HalfEdge( b, face );\n\t\t\tvar e2 = new HalfEdge( c, face );\n\n\t\t\t// join edges\n\n\t\t\te0.next = e2.prev = e1;\n\t\t\te1.next = e0.prev = e2;\n\t\t\te2.next = e1.prev = e0;\n\n\t\t\t// main half edge reference\n\n\t\t\tface.edge = e0;\n\n\t\t\treturn face.compute();\n\n\t\t}\n\n\t} );\n\n\tObject.assign( Face.prototype, {\n\n\t\ttoArray: function () {\n\t\t\tconst indices = [];\n\t\t\tlet edge = this.edge;\n\t\t\tdo {\n\t\t\t\tindices.push(edge.head().index);\n\t\t\t\tedge = edge.next;\n\t\t\t} while (edge !== this.edge);\n\t\t\treturn indices;\n\t\t},\n\n\t\tgetEdge: function ( i ) {\n\n\t\t\tvar edge = this.edge;\n\n\t\t\twhile ( i > 0 ) {\n\n\t\t\t\tedge = edge.next;\n\t\t\t\ti --;\n\n\t\t\t}\n\n\t\t\twhile ( i < 0 ) {\n\n\t\t\t\tedge = edge.prev;\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t\treturn edge;\n\n\t\t},\n\n\t\tcompute: function () {\n\n\t\t\tvar triangle;\n\n\t\t\treturn function compute() {\n\n\t\t\t\tif ( triangle === undefined ) triangle = new Triangle();\n\n\t\t\t\tvar a = this.edge.tail();\n\t\t\t\tvar b = this.edge.head();\n\t\t\t\tvar c = this.edge.next.head();\n\n\t\t\t\ttriangle.set( a.point, b.point, c.point );\n\n\t\t\t\ttriangle.getNormal( this.normal );\n\t\t\t\ttriangle.getMidpoint( this.midpoint );\n\t\t\t\tthis.area = triangle.getArea();\n\n\t\t\t\tthis.constant = this.normal.dot( this.midpoint );\n\n\t\t\t\treturn this;\n\n\t\t\t};\n\n\t\t}(),\n\n\t\tdistanceToPoint: function ( point ) {\n\n\t\t\treturn this.normal.dot( point ) - this.constant;\n\n\t\t}\n\n\t} );\n\n\t// Entity for a Doubly-Connected Edge List (DCEL).\n\n\tfunction HalfEdge( vertex, face ) {\n\n\t\tthis.vertex = vertex;\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t\tthis.twin = null;\n\t\tthis.face = face;\n\n\t}\n\n\tObject.assign( HalfEdge.prototype, {\n\n\t\thead: function () {\n\n\t\t\treturn this.vertex;\n\n\t\t},\n\n\t\ttail: function () {\n\n\t\t\treturn this.prev ? this.prev.vertex : null;\n\n\t\t},\n\n\t\tlength: function () {\n\n\t\t\tvar head = this.head();\n\t\t\tvar tail = this.tail();\n\n\t\t\tif ( tail !== null ) {\n\n\t\t\t\treturn tail.point.distanceTo( head.point );\n\n\t\t\t}\n\n\t\t\treturn - 1;\n\n\t\t},\n\n\t\tlengthSquared: function () {\n\n\t\t\tvar head = this.head();\n\t\t\tvar tail = this.tail();\n\n\t\t\tif ( tail !== null ) {\n\n\t\t\t\treturn tail.point.distanceToSquared( head.point );\n\n\t\t\t}\n\n\t\t\treturn - 1;\n\n\t\t},\n\n\t\tsetTwin: function ( edge ) {\n\n\t\t\tthis.twin = edge;\n\t\t\tedge.twin = this;\n\n\t\t\treturn this;\n\n\t\t}\n\n\t} );\n\n\t// A vertex as a double linked list node.\n\n\tfunction VertexNode( point, index ) {\n\n\t\tthis.point = point;\n\t\t// index in the input array\n\t\tthis.index = index;\n\t\tthis.prev = null;\n\t\tthis.next = null;\n\t\t// the face that is able to see this vertex\n\t\tthis.face = null;\n\n\t}\n\n\t// A double linked list that contains vertex nodes.\n\n\tfunction VertexList() {\n\n\t\tthis.head = null;\n\t\tthis.tail = null;\n\n\t}\n\n\tObject.assign( VertexList.prototype, {\n\n\t\tfirst: function () {\n\n\t\t\treturn this.head;\n\n\t\t},\n\n\t\tlast: function () {\n\n\t\t\treturn this.tail;\n\n\t\t},\n\n\t\tclear: function () {\n\n\t\t\tthis.head = this.tail = null;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Inserts a vertex before the target vertex\n\n\t\tinsertBefore: function ( target, vertex ) {\n\n\t\t\tvertex.prev = target.prev;\n\t\t\tvertex.next = target;\n\n\t\t\tif ( vertex.prev === null ) {\n\n\t\t\t\tthis.head = vertex;\n\n\t\t\t} else {\n\n\t\t\t\tvertex.prev.next = vertex;\n\n\t\t\t}\n\n\t\t\ttarget.prev = vertex;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Inserts a vertex after the target vertex\n\n\t\tinsertAfter: function ( target, vertex ) {\n\n\t\t\tvertex.prev = target;\n\t\t\tvertex.next = target.next;\n\n\t\t\tif ( vertex.next === null ) {\n\n\t\t\t\tthis.tail = vertex;\n\n\t\t\t} else {\n\n\t\t\t\tvertex.next.prev = vertex;\n\n\t\t\t}\n\n\t\t\ttarget.next = vertex;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Appends a vertex to the end of the linked list\n\n\t\tappend: function ( vertex ) {\n\n\t\t\tif ( this.head === null ) {\n\n\t\t\t\tthis.head = vertex;\n\n\t\t\t} else {\n\n\t\t\t\tthis.tail.next = vertex;\n\n\t\t\t}\n\n\t\t\tvertex.prev = this.tail;\n\t\t\tvertex.next = null; // the tail has no subsequent vertex\n\n\t\t\tthis.tail = vertex;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Appends a chain of vertices where 'vertex' is the head.\n\n\t\tappendChain: function ( vertex ) {\n\n\t\t\tif ( this.head === null ) {\n\n\t\t\t\tthis.head = vertex;\n\n\t\t\t} else {\n\n\t\t\t\tthis.tail.next = vertex;\n\n\t\t\t}\n\n\t\t\tvertex.prev = this.tail;\n\n\t\t\t// ensure that the 'tail' reference points to the last vertex of the chain\n\n\t\t\twhile ( vertex.next !== null ) {\n\n\t\t\t\tvertex = vertex.next;\n\n\t\t\t}\n\n\t\t\tthis.tail = vertex;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Removes a vertex from the linked list\n\n\t\tremove: function ( vertex ) {\n\n\t\t\tif ( vertex.prev === null ) {\n\n\t\t\t\tthis.head = vertex.next;\n\n\t\t\t} else {\n\n\t\t\t\tvertex.prev.next = vertex.next;\n\n\t\t\t}\n\n\t\t\tif ( vertex.next === null ) {\n\n\t\t\t\tthis.tail = vertex.prev;\n\n\t\t\t} else {\n\n\t\t\t\tvertex.next.prev = vertex.prev;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\t// Removes a list of vertices whose 'head' is 'a' and whose 'tail' is b\n\n\t\tremoveSubList: function ( a, b ) {\n\n\t\t\tif ( a.prev === null ) {\n\n\t\t\t\tthis.head = b.next;\n\n\t\t\t} else {\n\n\t\t\t\ta.prev.next = b.next;\n\n\t\t\t}\n\n\t\t\tif ( b.next === null ) {\n\n\t\t\t\tthis.tail = a.prev;\n\n\t\t\t} else {\n\n\t\t\t\tb.next.prev = a.prev;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tisEmpty: function () {\n\n\t\t\treturn this.head === null;\n\n\t\t}\n\n\t} );\n\n\treturn ConvexHull;\n\n} )();\n\nexport { ConvexHull };\n","import { BufferAttribute, BufferGeometry, Mesh, Object3D, Quaternion, Vector3 } from 'three';\nimport type { Geometry } from 'three/examples/jsm/deprecated/Geometry';\n\nconst _v1 = new Vector3();\nconst _v2 = new Vector3();\nconst _q1 = new Quaternion();\n\n/**\n* Returns a single geometry for the given object. If the object is compound,\n* its geometries are automatically merged. Bake world scale into each\n* geometry, because we can't easily apply that to the cannonjs shapes later.\n*/\nexport function getGeometry (object: Object3D): BufferGeometry | null {\n\tconst meshes = getMeshes(object);\n\tif (meshes.length === 0) return null;\n\n\t// Single mesh. Return, preserving original type.\n\tif (meshes.length === 1) {\n\t\treturn normalizeGeometry(meshes[0]);\n\t}\n\n\t// Multiple meshes. Merge and return.\n\tlet mesh: Mesh | undefined;\n\tconst geometries: BufferGeometry[] = [];\n\twhile ((mesh = meshes.pop())) {\n\t\tgeometries.push(simplifyGeometry(normalizeGeometry(mesh)));\n\t}\n\n\treturn mergeBufferGeometries(geometries);\n}\n\nfunction normalizeGeometry (mesh: Mesh): BufferGeometry {\n\tlet geometry: BufferGeometry = mesh.geometry;\n\tif ((geometry as unknown as Geometry).toBufferGeometry) {\n\t\tgeometry = (geometry as unknown as Geometry).toBufferGeometry();\n\t} else {\n\t\t// Preserve original type, e.g. CylinderBufferGeometry.\n\t\tgeometry = geometry.clone();\n\t}\n\n\tmesh.updateMatrixWorld();\n\tmesh.matrixWorld.decompose(_v1, _q1, _v2);\n\tgeometry.scale(_v2.x, _v2.y, _v2.z);\n\treturn geometry;\n}\n\n/**\n * Greatly simplified version of BufferGeometryUtils.mergeBufferGeometries.\n * Because we only care about the vertex positions, and not the indices or\n * other attributes, we throw everything else away.\n */\nfunction mergeBufferGeometries (geometries: BufferGeometry[]): BufferGeometry {\n\tlet vertexCount = 0;\n\tfor (let i = 0; i < geometries.length; i++) {\n\t\tconst position = geometries[i].attributes.position;\n\t\tif (position && position.itemSize === 3) {\n\t\t\tvertexCount += position.count;\n\t\t}\n\t}\n\n\tconst positionArray = new Float32Array(vertexCount * 3);\n\n\tlet positionOffset = 0;\n\tfor (let i = 0; i < geometries.length; i++) {\n\t\tconst position = geometries[i].attributes.position;\n\t\tif (position && position.itemSize === 3) {\n\t\t\tfor (let j = 0; j < position.count; j++) {\n\t\t\t\tpositionArray[positionOffset++] = position.getX(j);\n\t\t\t\tpositionArray[positionOffset++] = position.getY(j);\n\t\t\t\tpositionArray[positionOffset++] = position.getZ(j);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn new BufferGeometry().setAttribute('position', new BufferAttribute(positionArray, 3));\n}\n\nexport function getVertices (geometry: BufferGeometry): Float32Array {\n\tconst position = geometry.attributes.position;\n\tconst vertices = new Float32Array(position.count * 3);\n\tfor (let i = 0; i < position.count; i++) {\n\t\tvertices[i * 3] = position.getX(i);\n\t\tvertices[i * 3 + 1] = position.getY(i);\n\t\tvertices[i * 3 + 2] = position.getZ(i);\n\t}\n\treturn vertices;\n}\n\n/**\n* Returns a flat array of THREE.Mesh instances from the given object. If\n* nested transformations are found, they are applied to child meshes\n* as mesh.userData.matrix, so that each mesh has its position/rotation/scale\n* independently of all of its parents except the top-level object.\n*/\nfunction getMeshes (object: Object3D): Mesh[] {\n\tconst meshes: Mesh[] = [];\n\tobject.traverse(function (o) {\n\t\tif ((o as Mesh).isMesh) {\n\t\t\tmeshes.push(o as Mesh);\n\t\t}\n\t});\n\treturn meshes;\n}\n\nexport function getComponent(v: Vector3, component: string): number {\n\tswitch(component) {\n\t\tcase 'x': return v.x;\n\t\tcase 'y': return v.y;\n\t\tcase 'z': return v.z;\n\t}\n\tthrow new Error(`Unexpected component ${component}`);\n}\n\n/**\n* Modified version of BufferGeometryUtils.mergeVertices, ignoring vertex\n* attributes other than position.\n*\n* @param {THREE.BufferGeometry} geometry\n* @param {number} tolerance\n* @return {THREE.BufferGeometry>}\n*/\nfunction simplifyGeometry (geometry: BufferGeometry, tolerance = 1e-4): BufferGeometry {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex: {[key: string]: number} = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// Next value for triangle indices.\n\tlet nextIndex = 0;\n\n\tconst newIndices = [];\n\tconst newPositions = [];\n\n\t// Convert the error tolerance to an amount of decimal places to truncate to.\n\tconst decimalShift = Math.log10( 1 / tolerance );\n\tconst shiftMultiplier = Math.pow( 10, decimalShift );\n\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'.\n\t\tlet hash = '';\n\n\t\t// Double tilde truncates the decimal value.\n\t\thash += `${ ~ ~ ( positions.getX( index ) * shiftMultiplier ) },`;\n\t\thash += `${ ~ ~ ( positions.getY( index ) * shiftMultiplier ) },`;\n\t\thash += `${ ~ ~ ( positions.getZ( index ) * shiftMultiplier ) },`;\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index.\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\tnewPositions.push( positions.getX( index ) );\n\t\t\tnewPositions.push( positions.getY( index ) );\n\t\t\tnewPositions.push( positions.getZ( index ) );\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// Construct merged BufferGeometry.\n\n\tconst positionAttribute = new BufferAttribute(\n\t\tnew Float32Array( newPositions ),\n\t\tpositions.itemSize,\n\t\tpositions.normalized\n\t);\n\n\tconst result = new BufferGeometry();\n\tresult.setAttribute( 'position', positionAttribute );\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n","import { Box, ConvexPolyhedron, Cylinder, Quaternion as CQuaternion, Shape, Sphere, Trimesh, Vec3 } from 'cannon-es';\nimport { Box3, BufferGeometry, CylinderGeometry, MathUtils, Mesh, Object3D, SphereGeometry, Vector3 } from 'three';\nimport { ConvexHull } from '../lib/ConvexHull';\nimport { getComponent, getGeometry, getVertices } from './utils';\n\nconst PI_2 = Math.PI / 2;\n\nexport type BoxParameters = { x: number, y: number, z: number };\n\nexport type CylinderParameters = { radiusTop: number, radiusBottom: number, height: number, segments: number };\n\nexport type SphereParameters = { radius: number };\n\nexport type ConvexPolyhedronParameters = { vertices: Float32Array, faces: number[][] };\n\nexport type TrimeshParameters = { vertices: Float32Array, indices: Uint32Array };\n\ntype ShapeTypeToShapeParameters = {\n\tBox: BoxParameters,\n\tCylinder: CylinderParameters,\n\tSphere: SphereParameters,\n\tConvexPolyhedron: ConvexPolyhedronParameters,\n\tTrimesh: TrimeshParameters,\n};\n\nexport enum ShapeType {\n\tBOX = 'Box',\n\tCYLINDER = 'Cylinder',\n\tSPHERE = 'Sphere',\n\tHULL = 'ConvexPolyhedron',\n\tMESH = 'Trimesh',\n}\n\nexport interface ShapeOptions {\n\ttype?: ShapeType,\n\tcylinderAxis?: 'x' | 'y' | 'z',\n\tsphereRadius?: number,\n}\n\nexport interface ShapeParameters<T extends ShapeType = ShapeType> {\n\ttype: T,\n\tparams: ShapeTypeToShapeParameters[T],\n\toffset?: Vec3,\n\torientation?: CQuaternion,\n}\n\nexport interface ShapeResult<T extends Shape = Shape> {\n\tshape: T,\n\toffset?: Vec3,\n\torientation?: CQuaternion,\n}\n\n/**\n * Given a THREE.Object3D instance, creates parameters for a CANNON shape.\n */\nexport const getShapeParameters = function (object: Object3D, options: ShapeOptions = {}): ShapeParameters | null {\n\tlet geometry: BufferGeometry | null;\n\n\tif (options.type === ShapeType.BOX) {\n\t\treturn getBoundingBoxParameters(object);\n\t} else if (options.type === ShapeType.CYLINDER) {\n\t\treturn getBoundingCylinderParameters(object, options);\n\t} else if (options.type === ShapeType.SPHERE) {\n\t\treturn getBoundingSphereParameters(object, options);\n\t} else if (options.type === ShapeType.HULL) {\n\t\treturn getConvexPolyhedronParameters(object);\n\t} else if (options.type === ShapeType.MESH) {\n\t\tgeometry = getGeometry(object);\n\t\treturn geometry ? getTrimeshParameters(geometry) : null;\n\t} else if (options.type) {\n\t\tthrow new Error(`[CANNON.getShapeParameters] Invalid type \"${options.type}\".`);\n\t}\n\n\tgeometry = getGeometry(object);\n\tif (!geometry) return null;\n\n\tswitch (geometry.type) {\n\t\tcase 'BoxGeometry':\n\t\tcase 'BoxBufferGeometry':\n\t\t\treturn getBoxParameters(geometry);\n\t\tcase 'CylinderGeometry':\n\t\tcase 'CylinderBufferGeometry':\n\t\t\treturn getCylinderParameters(geometry as CylinderGeometry);\n\t\tcase 'PlaneGeometry':\n\t\tcase 'PlaneBufferGeometry':\n\t\t\treturn getPlaneParameters(geometry);\n\t\tcase 'SphereGeometry':\n\t\tcase 'SphereBufferGeometry':\n\t\t\treturn getSphereParameters(geometry as SphereGeometry);\n\t\tcase 'TubeGeometry':\n\t\tcase 'BufferGeometry':\n\t\t\treturn getBoundingBoxParameters(object);\n\t\tdefault:\n\t\t\tconsole.warn(\n\t\t\t\t'Unrecognized geometry: \"%s\". Using bounding box as shape.', geometry.type\n\t\t\t);\n\t\t\treturn getBoxParameters(geometry);\n\t}\n};\n\n/**\n * Given a THREE.Object3D instance, creates a corresponding CANNON shape.\n */\nexport const threeToCannon = function (object: Object3D, options: ShapeOptions = {}): ShapeResult | null {\n\tconst shapeParameters = getShapeParameters(object, options);\n\tif (!shapeParameters) {\n\t\treturn null;\n\t}\n\n\tconst { type, params, offset, orientation } = shapeParameters;\n\n\tlet shape: Shape;\n\tif (type === ShapeType.BOX) {\n\t\tshape = createBox(params as BoxParameters);\n\t} else if (type === ShapeType.CYLINDER) {\n\t\tshape = createCylinder(params as CylinderParameters);\n\t} else if (type === ShapeType.SPHERE) {\n\t\tshape = createSphere(params as SphereParameters);\n\t} else if (type === ShapeType.HULL) {\n\t\tshape = createConvexPolyhedron(params as ConvexPolyhedronParameters);\n\t} else {\n\t\tshape = createTrimesh(params as TrimeshParameters);\n\t}\n\n\treturn {\n\t\tshape,\n\t\toffset,\n\t\torientation,\n\t};\n};\n\n/******************************************************************************\n * Shape construction\n */\n\n function createBox (params: BoxParameters): Box {\n\tconst { x, y, z } = params;\n\tconst shape = new Box(new Vec3(x, y, z));\n\treturn shape;\n}\n\nfunction createCylinder (params: CylinderParameters): Cylinder {\n\tconst { radiusTop, radiusBottom, height, segments } = params;\n\n\tconst shape = new Cylinder(radiusTop, radiusBottom, height, segments);\n\n\t// Include metadata for serialization.\n\t// TODO(cleanup): Is this still necessary?\n\tshape.radiusTop = radiusBottom;\n\tshape.radiusBottom = radiusBottom;\n\tshape.height = height;\n\tshape.numSegments = segments;\n\n\treturn shape;\n}\n\nfunction createSphere (params: SphereParameters): Sphere {\n\tconst shape = new Sphere(params.radius);\n\n\treturn shape;\n}\n\nfunction createConvexPolyhedron (params: ConvexPolyhedronParameters): ConvexPolyhedron {\n\tconst { faces, vertices: verticesArray } = params;\n\n\tconst vertices: Vec3[] = [];\n\tfor (let i = 0; i < verticesArray.length; i += 3) {\n\t\tvertices.push(new Vec3(\n\t\t\tverticesArray[i],\n\t\t\tverticesArray[i + 1],\n\t\t\tverticesArray[i + 2]\n\t\t));\n\t}\n\n\tconst shape = new ConvexPolyhedron({\n\t\tfaces,\n\t\tvertices\n\t});\n\n\treturn shape;\n}\n\nfunction createTrimesh (params: TrimeshParameters): Trimesh {\n\tconst { vertices, indices } = params\n\tconst shape = new Trimesh(\n\t\tvertices as unknown as number[],\n\t\tindices as unknown as number[],\n\t);\n\n\treturn shape;\n}\n\n/******************************************************************************\n * Shape parameters\n */\n\nfunction getBoxParameters (geometry: BufferGeometry): ShapeParameters<ShapeType.BOX> | null {\n\tconst vertices = getVertices(geometry);\n\n\tif (!vertices.length) return null;\n\n\tgeometry.computeBoundingBox();\n\tconst box = geometry.boundingBox!;\n\n\treturn {\n\t\ttype: ShapeType.BOX,\n\t\tparams: {\n\t\t\tx: (box.max.x - box.min.x) / 2,\n\t\t\ty: (box.max.y - box.min.y) / 2,\n\t\t\tz: (box.max.z - box.min.z) / 2,\n\t\t},\n\t};\n}\n\n/** Bounding box needs to be computed with the entire subtree, not just geometry. */\nfunction getBoundingBoxParameters (object: Object3D): ShapeParameters<ShapeType.BOX> | null {\n\tconst clone = object.clone();\n\tclone.quaternion.set(0, 0, 0, 1);\n\tclone.updateMatrixWorld();\n\n\tconst box = new Box3().setFromObject(clone);\n\n\tif (!isFinite(box.min.lengthSq())) return null;\n\n\tconst localPosition = box.translate(clone.position.negate()).getCenter(new Vector3());\n\n\treturn {\n\t\ttype: ShapeType.BOX,\n\t\tparams: {\n\t\t\tx: (box.max.x - box.min.x) / 2,\n\t\t\ty: (box.max.y - box.min.y) / 2,\n\t\t\tz: (box.max.z - box.min.z) / 2,\n\t\t},\n\t\toffset: localPosition.lengthSq()\n\t\t\t? new Vec3(localPosition.x, localPosition.y, localPosition.z)\n\t\t\t: undefined,\n\t};\n}\n\n/** Computes 3D convex hull as a CANNON.ConvexPolyhedron. */\nfunction getConvexPolyhedronParameters (object: Object3D): ShapeParameters<ShapeType.HULL> | null {\n\tconst geometry = getGeometry(object);\n\n\tif (!geometry) return null;\n\n\t// Perturb.\n\tconst eps = 1e-4;\n\tfor (let i = 0; i < geometry.attributes.position.count; i++) {\n\t\tgeometry.attributes.position.setXYZ(\n\t\t\ti,\n\t\t\tgeometry.attributes.position.getX(i) + (Math.random() - 0.5) * eps,\n\t\t\tgeometry.attributes.position.getY(i) + (Math.random() - 0.5) * eps,\n\t\t\tgeometry.attributes.position.getZ(i) + (Math.random() - 0.5) * eps,\n\t\t);\n\t}\n\n\t// Compute the 3D convex hull and collect convex hull vertices and faces.\n\tconst [ positions, indices ] = new ConvexHull()\n\t\t.setFromObject(new Mesh(geometry))\n\t\t.toJSON();\n\n\treturn {\n\t\ttype: ShapeType.HULL,\n\t\tparams: {\n\t\t\tvertices: new Float32Array(positions),\n\t\t\tfaces: indices,\n\t\t},\n\t};\n}\n\nfunction getCylinderParameters (\n\tgeometry: CylinderGeometry\n): ShapeParameters<ShapeType.CYLINDER> | null {\n\tconst params = geometry.parameters;\n\n\treturn {\n\t\ttype: ShapeType.CYLINDER,\n\t\tparams: {\n\t\t\tradiusTop: params.radiusTop,\n\t\t\tradiusBottom: params.radiusBottom,\n\t\t\theight: params.height,\n\t\t\tsegments: params.radialSegments,\n\t\t},\n\t\torientation: new CQuaternion()\n\t\t\t.setFromEuler(MathUtils.degToRad(-90), 0, 0, 'XYZ')\n\t\t\t.normalize(),\n\t}\n}\n\nfunction getBoundingCylinderParameters (\n\tobject: Object3D,\n\toptions: ShapeOptions\n): ShapeParameters<ShapeType.CYLINDER> | null {\n\tconst axes = ['x', 'y', 'z'];\n\tconst majorAxis = options.cylinderAxis || 'y';\n\tconst minorAxes = axes.splice(axes.indexOf(majorAxis), 1) && axes;\n\tconst box = new Box3().setFromObject(object);\n\n\tif (!isFinite(box.min.lengthSq())) return null;\n\n\t// Compute cylinder dimensions.\n\tconst height = box.max[majorAxis] - box.min[majorAxis];\n\tconst radius = 0.5 * Math.max(\n\t\tgetComponent(box.max, minorAxes[0]) - getComponent(box.min, minorAxes[0]),\n\t\tgetComponent(box.max, minorAxes[1]) - getComponent(box.min, minorAxes[1]),\n\t);\n\n\tconst eulerX = majorAxis === 'y' ? PI_2 : 0;\n\tconst eulerY = majorAxis === 'z' ? PI_2 : 0;\n\n\treturn {\n\t\ttype: ShapeType.CYLINDER,\n\t\tparams: {\n\t\t\tradiusTop: radius,\n\t\t\tradiusBottom: radius,\n\t\t\theight,\n\t\t\tsegments: 12,\n\t\t},\n\t\torientation: new CQuaternion()\n\t\t\t.setFromEuler(eulerX, eulerY, 0, 'XYZ')\n\t\t\t.normalize(),\n\t};\n}\n\nfunction getPlaneParameters (geometry: BufferGeometry): ShapeParameters<ShapeType.BOX> | null {\n\tgeometry.computeBoundingBox();\n\tconst box = geometry.boundingBox!;\n\n\treturn {\n\t\ttype: ShapeType.BOX,\n\t\tparams: {\n\t\t\tx: (box.max.x - box.min.x) / 2 || 0.1,\n\t\t\ty: (box.max.y - box.min.y) / 2 || 0.1,\n\t\t\tz: (box.max.z - box.min.z) / 2 || 0.1,\n\t\t},\n\t};\n}\n\nfunction getSphereParameters (geometry: SphereGeometry): ShapeParameters<ShapeType.SPHERE> | null {\n\treturn {\n\t\ttype: ShapeType.SPHERE,\n\t\tparams: { radius: geometry.parameters.radius },\n\t};\n}\n\nfunction getBoundingSphereParameters (\n\tobject: Object3D,\n\toptions: ShapeOptions\n): ShapeParameters<ShapeType.SPHERE> | null {\n\tif (options.sphereRadius) {\n\t\treturn {\n\t\t\ttype: ShapeType.SPHERE,\n\t\t\tparams: { radius: options.sphereRadius },\n\t\t};\n\t}\n\tconst geometry = getGeometry(object);\n\tif (!geometry) return null;\n\tgeometry.computeBoundingSphere();\n\n\treturn {\n\t\ttype: ShapeType.SPHERE,\n\t\tparams: { radius: geometry.boundingSphere!.radius },\n\t};\n}\n\nfunction getTrimeshParameters (geometry: BufferGeometry): ShapeParameters<ShapeType.MESH> | null {\n\tconst vertices = getVertices(geometry);\n\n\tif (!vertices.length) return null;\n\n\tconst indices = new Uint32Array(vertices.length);\n\tfor (let i = 0; i < vertices.length; i++) {\n\t\tindices[i] = i;\n\t}\n\n\treturn {\n\t\ttype: ShapeType.MESH,\n\t\tparams: {\n\t\t\tvertices,\n\t\t\tindices,\n\t\t},\n\t};\n}\n"],"names":["ConvexHull","Visible","Deleted","v1","Vector3","tolerance","faces","newFaces","assigned","VertexList","unassigned","vertices","Object","assign","prototype","toJSON","srcIndices","map","f","toArray","uniqueSrcIndices","Array","from","Set","flat","sort","dstPositions","i","length","push","point","x","y","z","srcToDstIndexMap","Map","set","dstIndices","get","setFromPoints","points","isArray","console","error","makeEmpty","l","VertexNode","compute","setFromObject","object","updateMatrixWorld","traverse","node","geometry","undefined","isGeometry","toBufferGeometry","BufferGeometry","fromGeometry","isBufferGeometry","attribute","attributes","position","count","fromBufferAttribute","applyMatrix4","matrixWorld","containsPoint","face","distanceToPoint","intersectRay","ray","target","tNear","Infinity","tFar","vN","origin","vD","normal","dot","direction","t","Math","min","max","at","intersectsRay","addVertexToFace","vertex","outside","append","insertBefore","removeVertexFromFace","next","remove","removeAllVerticesFromFace","start","end","removeSubList","prev","deleteFaceVertices","absorbingFace","faceVertices","appendChain","nextVertex","distance","resolveUnassignedPoints","isEmpty","first","maxDistance","maxFace","mark","computeExtremes","minVertices","maxVertices","j","copy","getComponent","setComponent","Number","EPSILON","abs","computeInitialHull","line3","plane","closestPoint","Line3","Plane","extremes","v0","v2","v3","index","closestPointToPoint","distanceToSquared","setFromCoplanarPoints","Face","create","getEdge","setTwin","reindexFaces","activeFaces","nextVertexToAdd","eyeVertex","eyeFace","computeHorizon","eyePoint","crossEdge","horizon","edge","twinEdge","twin","oppositeFace","addAdjoiningFace","horizonEdge","tail","head","addNewFaces","firstSideEdge","previousSideEdge","sideEdge","addVertexToHull","clear","cleanup","midpoint","area","constant","a","b","c","e0","HalfEdge","e1","e2","indices","triangle","Triangle","getNormal","getMidpoint","getArea","distanceTo","lengthSquared","last","insertAfter","_v1","_v2","_q1","Quaternion","getGeometry","meshes","getMeshes","normalizeGeometry","mesh","geometries","pop","simplifyGeometry","mergeBufferGeometries","clone","decompose","scale","vertexCount","itemSize","positionArray","Float32Array","positionOffset","getX","getY","getZ","setAttribute","BufferAttribute","getVertices","o","isMesh","v","component","Error","hashToIndex","getIndex","positions","getAttribute","nextIndex","newIndices","newPositions","decimalShift","log10","shiftMultiplier","pow","hash","positionAttribute","normalized","result","setIndex","PI_2","PI","ShapeType","getShapeParameters","options","type","BOX","getBoundingBoxParameters","CYLINDER","getBoundingCylinderParameters","SPHERE","getBoundingSphereParameters","HULL","getConvexPolyhedronParameters","MESH","getTrimeshParameters","getBoxParameters","getCylinderParameters","getPlaneParameters","getSphereParameters","warn","threeToCannon","shapeParameters","params","offset","orientation","shape","createBox","createCylinder","createSphere","createConvexPolyhedron","createTrimesh","Box","Vec3","radiusTop","radiusBottom","height","segments","Cylinder","numSegments","Sphere","radius","verticesArray","ConvexPolyhedron","Trimesh","computeBoundingBox","box","boundingBox","quaternion","Box3","isFinite","lengthSq","localPosition","translate","negate","getCenter","eps","setXYZ","random","Mesh","parameters","radialSegments","CQuaternion","setFromEuler","MathUtils","degToRad","normalize","axes","majorAxis","cylinderAxis","minorAxes","splice","indexOf","eulerX","eulerY","sphereRadius","computeBoundingSphere","boundingSphere","Uint32Array"],"mappings":"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"}